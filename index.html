<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora FRIOR Cambio de Pezoneras</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #005566;
            color: #333;
        }
        .container {
            max-width: 700px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: relative;
        }
        .logo {
            display: block;
            margin: 0 auto 20px;
            width: 100px;
        }
        h1 {
            text-align: center;
            color: #005566;
            font-size: 24px;
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: #005566;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            font-size: 14px;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #005566;
            outline: none;
        }
        button {
            width: 100%;
            padding: 10px;
            background: #005566;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 15px;
            font-size: 14px;
        }
        button:hover {
            background: #003d4a;
        }
        #resultado {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .modificacion-campos {
            display: none;
            background: #f0f0f0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
        }
        #whatsapp-section, #donaciones-section {
            display: none;
            margin-top: 20px;
        }
        .signature {
            text-align: center;
            margin-top: 20px;
            font-family: 'Dancing Script', cursive;
            font-size: 28px;
            color: #005566;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background: #fff;
            padding: 20px;
            border-radius: 10px;
            max-width: 400px;
            text-align: center;
            position: relative;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        .popup-content h2 {
            color: #005566;
            margin-top: 0;
        }
        .popup-content p {
            margin: 10px 0;
        }
        .popup-content a {
            color: #005566;
            text-decoration: underline;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 24px;
            cursor: pointer;
            color: #333;
        }
        .admin-link {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 12px;
            color: #005566;
            text-decoration: none;
            opacity: 0.5;
        }
        .admin-link:hover {
            opacity: 1;
        }
        #publicidad-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
            text-align: center;
        }
        #publicidad-section img {
            max-width: 100%;
            height: auto;
        }
        #donaciones-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
            text-align: center;
        }
        #donaciones-section img {
            max-width: 300px;
            height: auto;
            display: block;
            margin: 0 auto;
        }
        #admin-form {
            display: none;
            margin-top: 20px;
        }
        #registro-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        #login-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
            display: none;
        }
        #user-section {
            display: none;
            margin-top: 20px;
        }
        #formulario-section {
            display: none;
        }
        .auth-message {
            text-align: center;
            margin-bottom: 20px;
            color: #005566;
        }
    </style>
</head>
<body>
    <!-- Pop-up -->
    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-btn" onclick="cerrarPopup()">√ó</span>
            <h2 id="popup-title">¬°Promociona tu negocio aqu√≠!</h2>
            <p id="popup-message">¬øQuieres que tu producto o servicio aparezca en esta calculadora? ¬°Cont√°ctame para publicidad!</p>
            <p id="popup-contact">üìß Escribe a: <a href="mailto:alfstiven@gmail.com">alfstiven@gmail.com</a></p>
        </div>
    </div>

    <div class="container">
        <!-- Enlace discreto para admin -->
        <a href="#" class="admin-link" onclick="mostrarLoginAdmin()">Admin</a>

        <img src="data:image/png;base64,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" alt="Logo FRIOR" class="logo">
        <h1>Calculadora FRIOR Cambio de Pezoneras</h1>

        <!-- Mensaje para usuarios no autenticados -->
        <div id="auth-message" class="auth-message">
            Por favor, reg√≠strate o inicia sesi√≥n para usar la calculadora.
        </div>

        <!-- Formulario de Registro -->
        <div id="registro-section">
            <h3>Reg√≠strate</h3>
            <label for="nombre">Nombre:</label>
            <input type="text" id="nombre" placeholder="Tu nombre" required>
            <label for="profesion">Profesi√≥n:</label>
            <select id="profesion" required>
                <option value="ganadero">Ganadero</option>
                <option value="tecnico">T√©cnico</option>
                <option value="otro">Otro</option>
            </select>
            <label for="email">Correo Electr√≥nico:</label>
            <input type="email" id="email" placeholder="tu@correo.com" required>
            <label for="password">Contrase√±a:</label>
            <input type="password" id="password" placeholder="Contrase√±a" required>
            <button type="button" onclick="registrarUsuario()">Registrarse</button>
            <p>¬øYa tienes cuenta? <a href="#" onclick="mostrarLoginUsuario()">Inicia sesi√≥n</a></p>
        </div>

        <!-- Formulario de Login de Usuario -->
        <div id="login-section">
            <h3>Iniciar Sesi√≥n</h3>
            <label for="login-email">Correo Electr√≥nico:</label>
            <input type="email" id="login-email" placeholder="tu@correo.com" required>
            <label for="login-password">Contrase√±a:</label>
            <input type="password" id="login-password" placeholder="Contrase√±a" required>
            <button type="button" onclick="loginUsuario()">Iniciar Sesi√≥n</button>
            <p>¬øNo tienes cuenta? <a href="#" onclick="mostrarRegistro()">Reg√≠strate</a></p>
        </div>

        <!-- Secci√≥n de usuario logueado -->
        <div id="user-section">
            <h3>Bienvenido, <span id="user-name">Usuario</span></h3>
            <p>Profesi√≥n: <span id="user-profesion">N/A</span></p>
            <label for="notificacion-preferencia">Notificarme sobre el cambio de pezoneras:</label>
            <select id="notificacion-preferencia">
                <option value="email">Por Correo Electr√≥nico</option>
                <option value="movil">Por Notificaci√≥n M√≥vil</option>
                <option value="ninguna">No notificar</option>
            </select>
            <button type="button" onclick="guardarPreferenciaNotificacion()">Guardar Preferencia</button>
            <button type="button" onclick="cerrarSesionUsuario()">Cerrar Sesi√≥n</button>
        </div>

        <!-- Formulario de la calculadora (visible solo para usuarios autenticados) -->
        <div id="formulario-section">
            <form id="formulario">
                <label for="ordenosDia">Orde√±os por D√≠a:</label>
                <input type="number" id="ordenosDia" required>

                <label for="puntosOrdeno">Puntos de Orde√±o (Inicial):</label>
                <input type="number" id="puntosOrdeno" required>

                <label for="vacas">Vacas Orde√±adas (Inicial):</label>
                <input type="number" id="vacas" required>

                <label for="durabilidad">Durabilidad de Pezoneras por Orde√±o por Punto:</label>
                <input type="number" id="durabilidad" value="2500" required>

                <label for="fechaInicio">Fecha de Inicio (opcional):</label>
                <input type="date" id="fechaInicio" placeholder="YYYY-MM-DD">

                <label for="diasEspecificos">Calcular para D√≠as Espec√≠ficos (opcional):</label>
                <input type="number" id="diasEspecificos" placeholder="N√∫mero de d√≠as">

                <label for="realizarModificacion">¬øModificar Vacas o Puntos?</label>
                <select id="realizarModificacion" onchange="mostrarCamposModificacion()">
                    <option value="no">No</option>
                    <option value="si">S√≠</option>
                </select>

                <div id="modificacion-campos" class="modificacion-campos">
                    <label for="fechaCambio">Fecha de Cambio:</label>
                    <input type="date" id="fechaCambio" placeholder="YYYY-MM-DD">

                    <label for="nuevoNumeroVacas">Nuevo N√∫mero de Vacas:</label>
                    <input type="number" id="nuevoNumeroVacas" placeholder="Nuevo n√∫mero de vacas">

                    <label for="nuevoPuntosOrdeno">Nuevo N√∫mero de Puntos:</label>
                    <input type="number" id="nuevoPuntosOrdeno" placeholder="Nuevo n√∫mero de puntos">
                </div>

                <button type="button" onclick="calcular()">Calcular</button>
                <button type="button" onclick="limpiarPantalla()">Limpiar</button>
            </form>
            <div id="resultado"></div>
        </div>

        <!-- Publicidad con Google AdSense -->
        <div style="margin-top: 20px; text-align: center;">
            <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-tu-id-de-cliente" crossorigin="anonymous"></script>
            <ins class="adsbygoogle"
                 style="display:block"
                 data-ad-client="ca-pub-tu-id-de-cliente"
                 data-ad-slot="tu-id-de-slot"
                 data-ad-format="auto"></ins>
            <script>
                 (adsbygoogle = window.adsbygoogle || []).push({});
            </script>
        </div>

        <!-- Secci√≥n de publicidad din√°mica -->
        <div id="publicidad-section"></div>

        <!-- Formulario de login para admin -->
        <div id="admin-login" style="display: none; margin-top: 20px;">
            <h3>Iniciar Sesi√≥n (Admin)</h3>
            <label for="admin-email">Correo Electr√≥nico:</label>
            <input type="email" id="admin-email" placeholder="admin@jcalculator.com">
            <label for="admin-password">Contrase√±a:</label>
            <input type="password" id="admin-password" placeholder="Contrase√±a">
            <button type="button" onclick="loginAdmin()">Iniciar Sesi√≥n</button>
        </div>

        <!-- Formulario para agregar publicidad -->
        <div id="admin-form" style="display: none;">
            <h3>Administrar Publicidad</h3>
            <h4>Publicidad Principal (Texto o Imagen)</h4>
            <label for="ad-type">Tipo de Publicidad:</label>
            <select id="ad-type" onchange="mostrarCamposPublicidad()">
                <option value="texto">Texto</option>
                <option value="imagen">Imagen</option>
            </select>
            <div id="ad-texto" style="display: block;">
                <label for="ad-texto-content">Texto de la Publicidad:</label>
                <textarea id="ad-texto-content" placeholder="Escribe el texto de la publicidad"></textarea>
            </div>
            <div id="ad-imagen" style="display: none;">
                <label for="ad-imagen-source">Fuente de la Imagen:</label>
                <select id="ad-imagen-source" onchange="mostrarCamposImagen()">
                    <option value="url">URL</option>
                    <option value="upload">Subir desde el dispositivo</option>
                </select>
                <div id="ad-imagen-url-section" style="display: block;">
                    <label for="ad-imagen-url">URL de la Imagen:</label>
                    <input type="text" id="ad-imagen-url" placeholder="Ingresa la URL de la imagen (opcional)">
                </div>
                <div id="ad-imagen-upload-section" style="display: none;">
                    <label for="ad-imagen-upload">Subir Imagen:</label>
                    <input type="file" id="ad-imagen-upload" accept="image/*">
                </div>
            </div>
            <button type="button" onclick="guardarPublicidad()">Guardar Publicidad Principal</button>

            <h4>Publicidad Secundaria (Imagen con Enlace)</h4>
            <label for="ad-secundaria-source">Fuente de la Imagen:</label>
            <select id="ad-secundaria-source" onchange="mostrarCamposImagenSecundaria()">
                <option value="url">URL</option>
                <option value="upload">Subir desde el dispositivo</option>
            </select>
            <div id="ad-secundaria-url-section" style="display: block;">
                <label for="ad-secundaria-imagen-url">URL de la Imagen:</label>
                <input type="text" id="ad-secundaria-imagen-url" placeholder="Ingresa la URL de la imagen (opcional)">
            </div>
            <div id="ad-secundaria-upload-section" style="display: none;">
                <label for="ad-secundaria-imagen-upload">Subir Imagen:</label>
                <input type="file" id="ad-secundaria-imagen-upload" accept="image/*">
            </div>
            <label for="ad-secundaria-link">Enlace de la Publicidad:</label>
            <input type="text" id="ad-secundaria-link" placeholder="Ingresa el enlace (ej. https://ejemplo.com)">
            <button type="button" onclick="guardarPublicidadSecundaria()">Guardar Publicidad Secundaria</button>

            <h4>Mensaje del Pop-up</h4>
            <label for="popup-message-content">Mensaje del Pop-up:</label>
            <textarea id="popup-message-content" placeholder="Escribe el mensaje del pop-up"></textarea>
            <button type="button" onclick="guardarPopupMessage()">Guardar Mensaje del Pop-up</button>

            <button type="button" onclick="cerrarSesionAdmin()">Cerrar Sesi√≥n</button>
        </div>

        <!-- WhatsApp Section -->
        <div id="whatsapp-section">
            <label for="codigoCliente">C√≥digo del Cliente:</label>
            <input type="text" id="codigoCliente" placeholder="Ingresa el c√≥digo del cliente" required>
            <button type="button" onclick="enviarWhatsApp()">Enviar por WhatsApp</button>
        </div>

        <!-- Secci√≥n de publicidad secundaria -->
        <div id="donaciones-section" style="text-align: center;"></div>

        <!-- Marketing de Afiliados -->
        <div style="margin-top: 20px; text-align: center;">
            <p>¬øNecesitas pezoneras nuevas? <a href="/comprar-pezoneras" target="_blank">Compra aqu√≠</a> y apoya esta herramienta.</p>
        </div>

        <div class="signature">J.Castle</div>
    </div>

    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDokCTsjDgQ94nu23rXf_HkvLeXpZmJU2c",
            authDomain: "jcalculador-ac481.firebaseapp.com",
            projectId: "jcalculador-ac481",
            storageBucket: "jcalculador-ac481.firebasestorage.app",
            messagingSenderId: "597989051329",
            appId: "1:597989051329:web:33b32c795cf7f51c63bd40",
            measurementId: "G-X4Z78DYMLD"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();
        const messaging = firebase.messaging();

        let resultadoTexto = '';
        let costoManoObra = 0;
        let vacasIniciales = 0;
        let puntosOrdenoIniciales = 0;
        let isAdminLoggedIn = false;
        let fechaProximoCambio = null;
        let currentUser = null;
        let adminUser = null; // Para manejar la sesi√≥n del administrador

        // Solicitar permiso para notificaciones
        function solicitarPermisoNotificaciones() {
            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    console.log('Permiso de notificaciones concedido.');
                    messaging.getToken({ vapidKey: 'BCaTUfW00kYdZyQ2BqdbR6HeTnAZtpxRWrF3jscJQXz4-3SaDNP2Z-y8EtWMtEu6DeUNekFhZQCQOYqRmEn-9Xg' }).then(token => {
                        console.log('Token FCM:', token);
                        if (currentUser) {
                            db.collection('users').doc(currentUser.uid).update({
                                fcmToken: token
                            }).catch(error => {
                                console.error('Error al guardar el token FCM:', error);
                            });
                        }
                    }).catch(error => {
                        console.error('Error al obtener el token FCM:', error);
                    });
                } else {
                    console.log('Permiso de notificaciones denegado.');
                }
            }).catch(error => {
                console.error('Error al solicitar permiso de notificaciones:', error);
            });
        }

        // Mostrar el pop-up y cargar publicidades al cargar la p√°gina
        window.onload = function() {
            document.getElementById('popup').style.display = 'flex';
            try {
                cargarPublicidad();
                cargarPublicidadSecundaria();
                cargarPopupMessage();
            } catch (error) {
                console.error('Error al cargar las publicidades:', error);
            }
            // Verificar si hay un usuario logueado
            auth.onAuthStateChanged(user => {
                if (user) {
                    if (!user.emailVerified) {
                        alert('Por favor, verifica tu correo electr√≥nico para continuar.');
                        auth.signOut();
                        return;
                    }
                    currentUser = user;
                    cargarDatosUsuario(user.uid);
                    document.getElementById('registro-section').style.display = 'none';
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('user-section').style.display = 'block';
                    document.getElementById('formulario-section').style.display = 'block';
                    document.getElementById('auth-message').style.display = 'none';
                    solicitarPermisoNotificaciones();
                    programarNotificacion(user.uid);
                } else {
                    currentUser = null;
                    document.getElementById('registro-section').style.display = 'block';
                    document.getElementById('user-section').style.display = 'none';
                    document.getElementById('formulario-section').style.display = 'none';
                    document.getElementById('auth-message').style.display = 'block';
                }
            });
        };

        function cerrarPopup() {
            document.getElementById('popup').style.display = 'none';
        }

        function mostrarCamposModificacion() {
            const seleccion = document.getElementById('realizarModificacion').value;
            document.getElementById('modificacion-campos').style.display = seleccion === 'si' ? 'block' : 'none';
        }

        function calcular() {
            const ordenosDiaInput = document.getElementById('ordenosDia').value;
            const puntosOrdenoInput = document.getElementById('puntosOrdeno').value;
            const vacasInput = document.getElementById('vacas').value;
            const durabilidadInput = document.getElementById('durabilidad').value;
            const fechaInicioInput = document.getElementById('fechaInicio').value;
            const diasEspecificosInput = document.getElementById('diasEspecificos').value;
            const realizarModificacion = document.getElementById('realizarModificacion').value;
            const fechaCambioInput = document.getElementById('fechaCambio').value;
            const nuevoNumeroVacasInput = document.getElementById('nuevoNumeroVacas').value;
            const nuevoPuntosOrdenoInput = document.getElementById('nuevoPuntosOrdeno').value;

            const ordenosDia = parseInt(ordenosDiaInput) || 0;
            let puntosOrdeno = parseInt(puntosOrdenoInput) || 0;
            const vacas = parseInt(vacasInput) || 0;
            const durabilidad = parseInt(durabilidadInput) || 0;
            const diasEspecificos = parseInt(diasEspecificosInput) || 0;
            const nuevoNumeroVacas = parseInt(nuevoNumeroVacasInput) || 0;
            const nuevoPuntosOrdeno = parseInt(nuevoPuntosOrdenoInput) || 0;

            vacasIniciales = vacas;
            puntosOrdenoIniciales = puntosOrdeno;

            if (ordenosDia <= 0) {
                alert("Por favor, ingresa un n√∫mero v√°lido de orde√±os por d√≠a (mayor que 0).");
                return;
            }
            if (puntosOrdeno <= 0) {
                alert("Por favor, ingresa un n√∫mero v√°lido de puntos de orde√±o (mayor que 0).");
                return;
            }
            if (vacas <= 0) {
                alert("Por favor, ingresa un n√∫mero v√°lido de vacas orde√±adas (mayor que 0).");
                return;
            }
            if (durabilidad <= 0) {
                alert("Por favor, ingresa una durabilidad v√°lida para las pezoneras (mayor que 0).");
                return;
            }

            let fechaInicio = fechaInicioInput ? new Date(fechaInicioInput) : new Date();
            if (isNaN(fechaInicio.getTime())) {
                alert("Por favor, selecciona una fecha de inicio v√°lida.");
                return;
            }

            if (diasEspecificos > 0 && ordenosDia === 0 && puntosOrdeno === 0 && vacas === 0) {
                const fechaDiasEspecificos = new Date(fechaInicio.getTime() + diasEspecificos * 86400000);
                resultadoTexto = `
                    Calculadora FRIOR Cambio de Pezoneras
                    Fecha Inicio: ${fechaInicio.toLocaleDateString('es-ES')}
                    Fecha para ${diasEspecificos} D√≠as: ${fechaDiasEspecificos.toLocaleDateString('es-ES')}
                `;
                mostrarResultados();
                return;
            }

            const orde√±osTotalesPorDia = ordenosDia * vacas;
            const orde√±osPorPuntoPorDia = orde√±osTotalesPorDia / puntosOrdeno;
            const diasDurabilidadInicial = durabilidad / orde√±osPorPuntoPorDia;

            const fechaProximoCambioInicial = new Date(fechaInicio);
            fechaProximoCambioInicial.setDate(fechaInicio.getDate() + Math.floor(diasDurabilidadInicial));

            let fechaDiasEspecificos = diasEspecificos > 0 ? `Fecha para ${diasEspecificos} D√≠as: ${new Date(fechaInicio.getTime() + diasEspecificos * 86400000).toLocaleDateString('es-ES')}` : '';

            const diasEnMes = 30.42;
            const mesesEquivalentes = Math.round(diasDurabilidadInicial / diasEnMes);

            const pezonerasPorPunto = 4;
            let totalPezoneras = puntosOrdeno * pezonerasPorPunto;
            costoManoObra = puntosOrdeno * 4;
            let desgastePezonerasPorDiaInicial = totalPezoneras / diasDurabilidadInicial;

            let durabilidadAjustada = diasDurabilidadInicial;
            let fechaProximoCambioAjustada = fechaProximoCambioInicial;
            let desgastePezonerasPorDiaAjustada = desgastePezonerasPorDiaInicial;
            let mensajeAjuste = '';

            if (realizarModificacion === 'si' && fechaCambioInput && (nuevoNumeroVacas > 0 || nuevoPuntosOrdeno > 0)) {
                const fechaCambio = new Date(fechaCambioInput);
                if (isNaN(fechaCambio.getTime())) {
                    alert("Por favor, selecciona una fecha de cambio v√°lida.");
                    return;
                }

                const diasTranscurridos = Math.floor((fechaCambio - fechaInicio) / (1000 * 60 * 60 * 24));

                if (diasTranscurridos < 0) {
                    alert("La fecha de cambio no puede ser anterior a la fecha de inicio.");
                    return;
                }

                const orde√±osPorPuntoHastaCambio = orde√±osPorPuntoPorDia * diasTranscurridos;
                const durabilidadRestante = durabilidad - orde√±osPorPuntoHastaCambio;

                if (durabilidadRestante <= 0) {
                    mensajeAjuste = `Nota: Las pezoneras ya debieron cambiarse antes de ${fechaCambio.toLocaleDateString('es-ES')}.`;
                } else {
                    const vacasAjustadas = nuevoNumeroVacas > 0 ? nuevoNumeroVacas : vacas;
                    const puntosOrdenoAjustados = nuevoPuntosOrdeno > 0 ? nuevoPuntosOrdeno : puntosOrdeno;
                    totalPezoneras = puntosOrdenoAjustados * pezonerasPorPunto;
                    costoManoObra = puntosOrdenoAjustados * 4;
                    const nuevosOrde√±osTotalesPorDia = ordenosDia * vacasAjustadas;
                    const nuevosOrde√±osPorPuntoPorDia = nuevosOrde√±osTotalesPorDia / puntosOrdenoAjustados;
                    const diasDurabilidadRestante = durabilidadRestante / nuevosOrde√±osPorPuntoPorDia;

                    fechaProximoCambioAjustada = new Date(fechaCambio);
                    fechaProximoCambioAjustada.setDate(fechaCambio.getDate() + Math.floor(diasDurabilidadRestante));

                    durabilidadAjustada = diasTranscurridos + diasDurabilidadRestante;
                    desgastePezonerasPorDiaAjustada = totalPezoneras / durabilidadAjustada;

                    mensajeAjuste = `
                        Ajuste por Modificaci√≥n:
                        Fecha de Cambio: ${fechaCambio.toLocaleDateString('es-ES')}
                        Nuevo N√∫mero de Vacas: ${vacasAjustadas}
                        Nuevo N√∫mero de Puntos: ${puntosOrdenoAjustados}
                        Durabilidad Ajustada: ${Math.floor(durabilidadAjustada)} d√≠as
                        Nueva Fecha de Cambio: ${fechaProximoCambioAjustada.toLocaleDateString('es-ES')}
                        Total Pezoneras: ${totalPezoneras}
                        Desgaste por D√≠a: ${desgastePezonerasPorDiaAjustada.toFixed(2)}
                    `;
                }
            }

            fechaProximoCambio = realizarModificacion === 'si' ? fechaProximoCambioAjustada : fechaProximoCambioInicial;

            resultadoTexto = `
                Calculadora FRIOR Cambio de Pezoneras
                Fecha Inicio: ${fechaInicio.toLocaleDateString('es-ES')}
                Vacas Iniciales: ${vacasIniciales}
                Puntos Iniciales: ${puntosOrdenoIniciales}
                Durabilidad Inicial: ${Math.floor(diasDurabilidadInicial)} d√≠as
                Pr√≥ximo Cambio Inicial: ${fechaProximoCambioInicial.toLocaleDateString('es-ES')}
                Meses Equivalentes: ${mesesEquivalentes}
                ${fechaDiasEspecificos}
                Total Pezoneras Inicial: ${puntosOrdeno * pezonerasPorPunto}
                Desgaste por D√≠a Inicial: ${desgastePezonerasPorDiaInicial.toFixed(2)}
                Costo Mano de Obra: ${costoManoObra} ‚Ç¨
                ${mensajeAjuste}
            `;
            mostrarResultados();

            // Guardar la fecha del pr√≥ximo cambio para el usuario
            if (currentUser) {
                guardarFechaProximoCambio(currentUser.uid, fechaProximoCambio);
            }
        }

        function mostrarResultados() {
            document.getElementById('resultado').innerHTML = resultadoTexto.replace(/\n/g, '<br>');
            document.getElementById('whatsapp-section').style.display = 'block';
            document.getElementById('donaciones-section').style.display = 'block';
        }

        function enviarWhatsApp() {
            const codigoCliente = document.getElementById('codigoCliente').value.trim();
            if (!codigoCliente) {
                alert("Ingresa el c√≥digo del cliente.");
                return;
            }
            const mensajeWhatsApp = `C√≥digo del Cliente: ${codigoCliente}\n${resultadoTexto}`;
            const urlWhatsApp = `https://api.whatsapp.com/send?text=${encodeURIComponent(mensajeWhatsApp)}`;
            window.open(urlWhatsApp, '_blank');
        }

        function limpiarPantalla() {
            const durabilidad = document.getElementById('durabilidad').value;
            document.getElementById('formulario').reset();
            document.getElementById('durabilidad').value = durabilidad;
            document.getElementById('modificacion-campos').style.display = 'none';
            document.getElementById('resultado').innerHTML = '';
            document.getElementById('whatsapp-section').style.display = 'none';
            document.getElementById('donaciones-section').style.display = 'none';
            document.getElementById('codigoCliente').value = '';
            resultadoTexto = '';
            costoManoObra = 0;
            vacasIniciales = 0;
            puntosOrdenoIniciales = 0;
            fechaProximoCambio = null;
        }

        // Funciones de administraci√≥n
        function mostrarLoginAdmin() {
            document.getElementById('admin-login').style.display = 'block';
            document.getElementById('admin-form').style.display = 'none';
            return false;
        }

        function loginAdmin() {
            const email = document.getElementById('admin-email').value.trim();
            const password = document.getElementById('admin-password').value.trim();

            if (!email || !password) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    adminUser = userCredential.user;
                    isAdminLoggedIn = true;
                    document.getElementById('admin-login').style.display = 'none';
                    document.getElementById('admin-form').style.display = 'block';
                    try {
                        cargarPublicidad();
                        cargarPublicidadSecundaria();
                        cargarPopupMessage();
                    } catch (error) {
                        console.error('Error al cargar las publicidades despu√©s de login:', error);
                    }
                })
                .catch(error => {
                    console.error('Error al iniciar sesi√≥n como administrador:', error);
                    alert('Error al iniciar sesi√≥n: ' + error.message);
                });
        }

        function cerrarSesionAdmin() {
            auth.signOut()
                .then(() => {
                    isAdminLoggedIn = false;
                    adminUser = null;
                    document.getElementById('admin-login').style.display = 'none';
                    document.getElementById('admin-form').style.display = 'none';
                    document.getElementById('admin-email').value = '';
                    document.getElementById('admin-password').value = '';
                })
                .catch(error => {
                    console.error('Error al cerrar sesi√≥n del administrador:', error);
                    alert('Error al cerrar sesi√≥n: ' + error.message);
                });
        }

        function mostrarCamposPublicidad() {
            const adType = document.getElementById('ad-type').value;
            document.getElementById('ad-texto').style.display = adType === 'texto' ? 'block' : 'none';
            document.getElementById('ad-imagen').style.display = adType === 'imagen' ? 'block' : 'none';
        }

        function mostrarCamposImagen() {
            const source = document.getElementById('ad-imagen-source').value;
            document.getElementById('ad-imagen-url-section').style.display = source === 'url' ? 'block' : 'none';
            document.getElementById('ad-imagen-upload-section').style.display = source === 'upload' ? 'block' : 'none';
        }

        function mostrarCamposImagenSecundaria() {
            const source = document.getElementById('ad-secundaria-source').value;
            document.getElementById('ad-secundaria-url-section').style.display = source === 'url' ? 'block' : 'none';
            document.getElementById('ad-secundaria-upload-section').style.display = source === 'upload' ? 'block' : 'none';
        }

        function guardarPublicidad() {
            if (!isAdminLoggedIn) {
                alert('Debes iniciar sesi√≥n como administrador para guardar la publicidad.');
                return;
            }

            const adType = document.getElementById('ad-type').value;
            let adContent = {};

            if (adType === 'texto') {
                const textoContent = document.getElementById('ad-texto-content').value.trim();
                if (!textoContent) {
                    alert('Por favor, ingresa un texto para la publicidad principal.');
                    return;
                }
                adContent = {
                    type: 'texto',
                    content: textoContent
                };
                saveAdToFirestore(adContent);
            } else {
                const source = document.getElementById('ad-imagen-source').value;
                if (source === 'url') {
                    const imagenUrl = document.getElementById('ad-imagen-url').value.trim();
                    if (!imagenUrl) {
                        alert('Por favor, ingresa una URL v√°lida para la imagen.');
                        return;
                    }
                    adContent = {
                        type: 'imagen',
                        content: imagenUrl
                    };
                    saveAdToFirestore(adContent);
                } else {
                    const fileInput = document.getElementById('ad-imagen-upload');
                    const file = fileInput.files[0];
                    if (!file) {
                        alert('Por favor, selecciona una imagen para subir.');
                        return;
                    }
                    const storageRef = storage.ref(`publicidad/principal/${file.name}`);
                    storageRef.put(file)
                        .then(snapshot => snapshot.ref.getDownloadURL())
                        .then(downloadURL => {
                            adContent = {
                                type: 'imagen',
                                content: downloadURL
                            };
                            saveAdToFirestore(adContent);
                        })
                        .catch(error => {
                            console.error('Error al subir la imagen:', error);
                            alert('Error al subir la imagen: ' + error.message);
                        });
                }
            }
        }

        function saveAdToFirestore(adContent) {
            db.collection('publicidad').doc('principal').set(adContent)
                .then(() => {
                    cargarPublicidad();
                    alert('Publicidad principal guardada correctamente.');
                })
                .catch(error => {
                    console.error('Error al guardar la publicidad principal:', error);
                    alert('Error al guardar la publicidad principal: ' + error.message);
                });
        }

        function guardarPublicidadSecundaria() {
            if (!isAdminLoggedIn) {
                alert('Debes iniciar sesi√≥n como administrador para guardar la publicidad.');
                return;
            }

            const source = document.getElementById('ad-secundaria-source').value;
            const enlace = document.getElementById('ad-secundaria-link').value.trim();

            if (!enlace) {
                alert('Por favor, ingresa el enlace para la publicidad secundaria.');
                return;
            }

            if (source === 'url') {
                const imagenUrl = document.getElementById('ad-secundaria-imagen-url').value.trim();
                if (!imagenUrl) {
                    alert('Por favor, ingresa una URL v√°lida para la imagen.');
                    return;
                }
                const adContent = {
                    imagenUrl: imagenUrl,
                    enlace: enlace
                };
                saveSecondaryAdToFirestore(adContent);
            } else {
                const fileInput = document.getElementById('ad-secundaria-imagen-upload');
                const file = fileInput.files[0];
                if (!file) {
                    alert('Por favor, selecciona una imagen para subir.');
                    return;
                }
                const storageRef = storage.ref(`publicidad/secundaria/${file.name}`);
                storageRef.put(file)
                    .then(snapshot => snapshot.ref.getDownloadURL())
                    .then(downloadURL => {
                        const adContent = {
                            imagenUrl: downloadURL,
                            enlace: enlace
                        };
                        saveSecondaryAdToFirestore(adContent);
                    })
                    .catch(error => {
                        console.error('Error al subir la imagen secundaria:', error);
                        alert('Error al subir la imagen secundaria: ' + error.message);
                    });
            }
        }

        function saveSecondaryAdToFirestore(adContent) {
            db.collection('publicidad').doc('secundaria').set(adContent)
                .then(() => {
                    cargarPublicidadSecundaria();
                    alert('Publicidad secundaria guardada correctamente.');
                })
                .catch(error => {
                    console.error('Error al guardar la publicidad secundaria:', error);
                    alert('Error al guardar la publicidad secundaria: ' + error.message);
                });
        }

        function guardarPopupMessage() {
            if (!isAdminLoggedIn) {
                alert('Debes iniciar sesi√≥n como administrador para guardar el mensaje del pop-up.');
                return;
            }

            const messageContent = document.getElementById('popup-message-content').value.trim();
            if (!messageContent) {
                alert('Por favor, ingresa un mensaje para el pop-up.');
                return;
            }

            db.collection('config').doc('popup').set({
                title: "¬°Promociona tu negocio aqu√≠!",
                message: messageContent,
                contact: "üìß Escribe a: alfstiven@gmail.com"
            })
                .then(() => {
                    cargarPopupMessage();
                    alert('Mensaje del pop-up guardado correctamente.');
                })
                .catch(error => {
                    console.error('Error al guardar el mensaje del pop-up:', error);
                    alert('Error al guardar el mensaje del pop-up: ' + error.message);
                });
        }

        function cargarPublicidad() {
            const publicidadSection = document.getElementById('publicidad-section');
            db.collection('publicidad').doc('principal').get()
                .then(doc => {
                    if (doc.exists) {
                        const ad = doc.data();
                        if (ad.type === 'texto') {
                            publicidadSection.innerHTML = `<p>${ad.content}</p>`;
                        } else if (ad.type === 'imagen') {
                            publicidadSection.innerHTML = `<img src="${ad.content}" alt="Publicidad">`;
                        }
                    } else {
                        publicidadSection.innerHTML = '<p>No hay publicidad principal configurada.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar la publicidad principal:', error);
                    publicidadSection.innerHTML = '<p>Error al cargar la publicidad principal: ' + error.message + '</p>';
                });
        }

        function cargarPublicidadSecundaria() {
            const donacionesSection = document.getElementById('donaciones-section');
            db.collection('publicidad').doc('secundaria').get()
                .then(doc => {
                    if (doc.exists) {
                        const ad = doc.data();
                        donacionesSection.innerHTML = `
                            <a href="${ad.enlace}" target="_blank">
                                <img src="${ad.imagenUrl}" alt="Publicidad Secundaria">
                            </a>
                        `;
                    } else {
                        donacionesSection.innerHTML = '<p>No hay publicidad secundaria configurada.</p>';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar la publicidad secundaria:', error);
                    donacionesSection.innerHTML = '<p>Error al cargar la publicidad secundaria: ' + error.message + '</p>';
                });
        }

        function cargarPopupMessage() {
            const popupTitle = document.getElementById('popup-title');
            const popupMessage = document.getElementById('popup-message');
            const popupContact = document.getElementById('popup-contact');
            db.collection('config').doc('popup').get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        popupTitle.textContent = data.title;
                        popupMessage.textContent = data.message;
                        popupContact.innerHTML = `üìß Escribe a: <a href="mailto:alfstiven@gmail.com">${data.contact}</a>`;
                    } else {
                        popupTitle.textContent = "¬°Promociona tu negocio aqu√≠!";
                        popupMessage.textContent = "¬øQuieres que tu producto o servicio aparezca en esta calculadora? ¬°Cont√°ctame para publicidad!";
                        popupContact.innerHTML = 'üìß Escribe a: <a href="mailto:alfstiven@gmail.com">alfstiven@gmail.com</a>';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar el mensaje del pop-up:', error);
                });
        }

        // Funciones de registro y login de usuarios
        function registrarUsuario() {
            const nombre = document.getElementById('nombre').value.trim();
            const profesion = document.getElementById('profesion').value;
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();

            if (!nombre || !profesion || !email || !password) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    return Promise.all([
                        user.sendEmailVerification(),
                        db.collection('users').doc(user.uid).set({
                            nombre: nombre,
                            profesion: profesion,
                            email: email,
                            notificacionPreferencia: 'ninguna',
                            fechaProximoCambio: null,
                            fcmToken: null
                        })
                    ]);
                })
                .then(() => {
                    alert('Usuario registrado correctamente. Revisa tu correo para verificar tu cuenta.');
                    auth.signOut();
                    document.getElementById('registro-section').style.display = 'none';
                    document.getElementById('login-section').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error al registrar usuario:', error);
                    alert('Error al registrar usuario: ' + error.message);
                });
        }

        function loginUsuario() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value.trim();

            if (!email || !password) {
                alert('Por favor, completa todos los campos.');
                return;
            }

            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    const user = userCredential.user;
                    if (!user.emailVerified) {
                        alert('Por favor, verifica tu correo electr√≥nico para continuar.');
                        auth.signOut();
                        return;
                    }
                    alert('Inicio de sesi√≥n exitoso.');
                    document.getElementById('login-section').style.display = 'none';
                    document.getElementById('user-section').style.display = 'block';
                    document.getElementById('formulario-section').style.display = 'block';
                    document.getElementById('auth-message').style.display = 'none';
                })
                .catch(error => {
                    console.error('Error al iniciar sesi√≥n:', error);
                    alert('Error al iniciar sesi√≥n: ' + error.message);
                });
        }

        function cerrarSesionUsuario() {
            auth.signOut()
                .then(() => {
                    currentUser = null;
                    document.getElementById('user-section').style.display = 'none';
                    document.getElementById('formulario-section').style.display = 'none';
                    document.getElementById('registro-section').style.display = 'block';
                    document.getElementById('auth-message').style.display = 'block';
                    document.getElementById('user-name').textContent = 'Usuario';
                    document.getElementById('user-profesion').textContent = 'N/A';
                })
                .catch(error => {
                    console.error('Error al cerrar sesi√≥n:', error);
                    alert('Error al cerrar sesi√≥n: ' + error.message);
                });
        }

        function mostrarRegistro() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('registro-section').style.display = 'block';
        }

        function mostrarLoginUsuario() {
            document.getElementById('registro-section').style.display = 'none';
            document.getElementById('login-section').style.display = 'block';
        }

        function cargarDatosUsuario(uid) {
            db.collection('users').doc(uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        document.getElementById('user-name').textContent = data.nombre || 'Usuario';
                        document.getElementById('user-profesion').textContent = data.profesion || 'N/A';
                        document.getElementById('notificacion-preferencia').value = data.notificacionPreferencia || 'ninguna';
                    } else {
                        console.error('No se encontraron datos del usuario.');
                        document.getElementById('user-name').textContent = 'Usuario';
                        document.getElementById('user-profesion').textContent = 'N/A';
                    }
                })
                .catch(error => {
                    console.error('Error al cargar datos del usuario:', error);
                    document.getElementById('user-name').textContent = 'Usuario';
                    document.getElementById('user-profesion').textContent = 'N/A';
                });
        }

        function guardarPreferenciaNotificacion() {
            const preferencia = document.getElementById('notificacion-preferencia').value;
            if (currentUser) {
                db.collection('users').doc(currentUser.uid).update({
                    notificacionPreferencia: preferencia
                })
                    .then(() => {
                        alert('Preferencia de notificaci√≥n guardada.');
                        if (preferencia === 'movil') {
                            solicitarPermisoNotificaciones();
                        }
                    })
                    .catch(error => {
                        console.error('Error al guardar preferencia de notificaci√≥n:', error);
                        alert('Error al guardar preferencia de notificaci√≥n: ' + error.message);
                    });
            }
        }

        function guardarFechaProximoCambio(uid, fecha) {
            db.collection('users').doc(uid).update({
                fechaProximoCambio: fecha.toISOString()
            })
                .then(() => {
                    console.log('Fecha del pr√≥ximo cambio guardada.');
                    programarNotificacion(uid);
                })
                .catch(error => {
                    console.error('Error al guardar la fecha del pr√≥ximo cambio:', error);
                });
        }

        function programarNotificacion(uid) {
            db.collection('users').doc(uid).get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const preferencia = data.notificacionPreferencia;
                        const fechaCambio = data.fechaProximoCambio ? new Date(data.fechaProximoCambio) : null;
                        if (!fechaCambio) return;

                        const hoy = new Date();
                        hoy.setHours(0, 0, 0, 0);
                        fechaCambio.setHours(0, 0, 0, 0);

                        if (fechaCambio.getTime() === hoy.getTime()) {
                            const mensaje = "üîî ¬°Es hora de actuar! Cambia tus pezoneras hoy para asegurar una orde√±a eficiente y la mejor calidad en tu producci√≥n. üêÑ Con FRIOR, tu √©xito est√° garantizado. ‚ú®";
                            if (preferencia === 'email') {
                                enviarCorreoNotificacion(data.email, mensaje);
                            } else if (preferencia === 'movil' && data.fcmToken) {
                                enviarNotificacionMovil(data.fcmToken, mensaje);
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error al programar notificaci√≥n:', error);
                });
        }

        function enviarCorreoNotificacion(email, mensaje) {
            fetch('https://us-central1-jcalculador-ac481.cloudfunctions.net/sendEmail', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    email: email,
                    message: mensaje
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Correo enviado:', data);
            })
            .catch(error => {
                console.error('Error al enviar correo:', error);
            });
        }

        function enviarNotificacionMovil(fcmToken, mensaje) {
            fetch('https://fcm.googleapis.com/fcm/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': 'key=YOUR_SERVER_KEY' // 3447639f4d49e6f899b27c5be258a941b22878e1
                },
                body: JSON.stringify({
                    to: fcmToken,
                    notification: {
                        title: 'Recordatorio de Cambio de Pezoneras',
                        body: mensaje
                    }
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Notificaci√≥n enviada:', data);
            })
            .catch(error => {
                console.error('Error al enviar notificaci√≥n:', error);
            });
        }

        document.querySelectorAll('#formulario input').forEach(input => {
            input.addEventListener('keydown', function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    calcular();
                }
            });
        });
    </script>
</body>
</html>
