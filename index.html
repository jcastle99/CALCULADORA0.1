<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>jCalculo</title>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-messaging-compat.js"></script>
    <!-- SheetJS para exportar a Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 600px;
            text-align: center;
        }
        h1 {
            font-family: 'Dancing Script', cursive;
            color: #333;
            font-size: 2.5em;
            margin-bottom: 20px;
        }
        h2, h3 {
            color: #333;
        }
        input, select, textarea, button {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            background-color: #5cb85c;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #4cae4c;
        }
        #resultado {
            margin-top: 20px;
            font-size: 1.2em;
            color: #333;
        }
        .auth-message {
            color: #333;
            margin-bottom: 20px;
        }
        .admin-link {
            position: absolute;
            top: 10px;
            right: 10px;
            color: #007bff;
            text-decoration: none;
        }
        .admin-link:hover {
            text-decoration: underline;
        }
        #publicidad-section, #donaciones-section {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        #publicidad-section img, #donaciones-section img {
            max-width: 100%;
            height: auto;
            border-radius: 5px;
        }
        .signature {
            margin-top: 20px;
            font-size: 0.9em;
            color: #777;
        }
        .popup {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        .popup-content {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            position: relative;
            max-width: 500px;
            width: 90%;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            font-size: 1.5em;
            cursor: pointer;
        }
        #login-section, #registro-section, #user-section, #formulario-section, #admin-form, #calculos-registrados {
            display: none;
        }
        #calculos-registrados {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        #calculos-registrados ul {
            list-style: none;
            padding: 0;
        }
        #calculos-registrados li {
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }
        #admin-calculos {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 5px;
        }
        #admin-calculos ul {
            list-style: none;
            padding: 0;
        }
        #admin-calculos li {
            padding: 5px 0;
            border-bottom: 1px solid #ddd;
        }
        .modificacion-campos {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Pop-up -->
    <div id="popup" class="popup">
        <div class="popup-content">
            <span class="close-btn" onclick="cerrarPopup()">칑</span>
            <h2 id="popup-title">춰Promociona tu negocio aqu칤!</h2>
            <p id="popup-message">쯈uieres que tu producto o servicio aparezca en esta calculadora? 춰Cont치ctame para publicidad!</p>
            <p id="popup-contact">游닎 Escribe a: <a href="mailto:alfstiven@gmail.com">alfstiven@gmail.com</a></p>
        </div>
    </div>

    <div class="container">
        <!-- Enlace discreto para admin -->
        <a href="#" class="admin-link" onclick="mostrarLoginAdmin()">Admin</a>

        <h1>jCalculo</h1>

        <!-- Secci칩n de login -->
        <div id="login-section">
            <h2>Iniciar Sesi칩n</h2>
            <input type="email" id="login-email" placeholder="Correo electr칩nico">
            <input type="password" id="login-password" placeholder="Contrase침a">
            <button onclick="iniciarSesion()">Iniciar Sesi칩n</button>
            <p>쯅o tienes cuenta? <a href="#" onclick="mostrarRegistro()">Reg칤strate aqu칤</a></p>
        </div>

        <!-- Secci칩n de registro -->
        <div id="registro-section">
            <h2>Registro</h2>
            <input type="email" id="registro-email" placeholder="Correo electr칩nico">
            <input type="password" id="registro-password" placeholder="Contrase침a">
            <button onclick="registrarUsuario()">Registrarse</button>
            <p>쯏a tienes cuenta? <a href="#" onclick="mostrarLogin()">Inicia sesi칩n aqu칤</a></p>
        </div>

        <!-- Secci칩n de usuario autenticado -->
        <div id="user-section">
            <p class="auth-message">Bienvenido, <span id="user-email"></span> | <a href="#" onclick="cerrarSesion()">Cerrar Sesi칩n</a></p>
        </div>

        <!-- Formulario de la calculadora -->
        <div id="formulario-section">
            <label for="num1">Primer n칰mero:</label>
            <input type="number" id="num1" placeholder="Ingresa el primer n칰mero">
            <label for="num2">Segundo n칰mero:</label>
            <input type="number" id="num2" placeholder="Ingresa el segundo n칰mero">
            <label for="operacion">Operaci칩n:</label>
            <select id="operacion">
                <option value="suma">Suma</option>
                <option value="resta">Resta</option>
                <option value="multiplicacion">Multiplicaci칩n</option>
                <option value="division">Divisi칩n</option>
            </select>
            <label><input type="checkbox" id="guardar-calculo"> Guardar este c치lculo</label>
            <button onclick="calcular()">Calcular</button>
            <div id="resultado"></div>
        </div>

        <!-- Secci칩n de c치lculos registrados -->
        <div id="calculos-registrados">
            <h3>Mis C치lculos</h3>
            <ul id="lista-calculos"></ul>
            <button onclick="exportarCalculosUsuario()">Exportar a Excel</button>
        </div>

        <!-- Secci칩n de publicidad principal -->
        <div id="publicidad-section"></div>

        <!-- Secci칩n de donaciones -->
        <div id="donaciones-section">
            <p>쯊e ha sido 칰til esta calculadora? 춰Considera hacer una donaci칩n!</p>
            <a href="https://www.paypal.com/donate?hosted_button_id=TU_CODIGO" target="_blank">Dona aqu칤</a>
        </div>

        <!-- Formulario de administraci칩n -->
        <div id="admin-form">
            <h2>Panel de Administraci칩n</h2>
            <h3>Publicidad Principal</h3>
            <label for="publicidad-tipo">Tipo de Publicidad:</label>
            <select id="publicidad-tipo" onchange="mostrarCamposPublicidad()">
                <option value="texto">Texto</option>
                <option value="imagen">Imagen</option>
            </select>
            <div id="publicidad-texto-campos">
                <label for="publicidad-texto">Texto:</label>
                <textarea id="publicidad-texto" placeholder="Ingresa el texto de la publicidad"></textarea>
                <label for="publicidad-url">URL (opcional):</label>
                <input type="url" id="publicidad-url" placeholder="Ingresa la URL">
            </div>
            <div id="publicidad-imagen-campos" class="modificacion-campos">
                <label for="publicidad-imagen">Subir Imagen:</label>
                <input type="file" id="publicidad-imagen" accept="image/*">
                <label for="publicidad-imagen-url">URL (opcional):</label>
                <input type="url" id="publicidad-imagen-url" placeholder="Ingresa la URL">
            </div>
            <button onclick="guardarPublicidadPrincipal()">Guardar Publicidad Principal</button>

            <h3>Publicidad Secundaria (Donaciones)</h3>
            <label for="donaciones-imagen">Subir Imagen:</label>
            <input type="file" id="donaciones-imagen" accept="image/*">
            <label for="donaciones-url">URL (opcional):</label>
            <input type="url" id="donaciones-url" placeholder="Ingresa la URL">
            <button onclick="guardarPublicidadSecundaria()">Guardar Publicidad Secundaria</button>

            <!-- Secci칩n para ver todos los c치lculos -->
            <div id="admin-calculos">
                <h3>C치lculos de Todos los Usuarios</h3>
                <ul id="lista-calculos-admin"></ul>
                <button onclick="exportarCalculosAdmin()">Exportar Todos los C치lculos a Excel</button>
            </div>
        </div>

        <div class="signature">jCalculo</div>
    </div>

    <script>
        // Configuraci칩n de Firebase
        const firebaseConfig = {
            apiKey: "TU_API_KEY",
            authDomain: "TU_AUTH_DOMAIN",
            projectId: "TU_PROJECT_ID",
            storageBucket: "TU_STORAGE_BUCKET",
            messagingSenderId: "TU_MESSAGING_SENDER_ID",
            appId: "TU_APP_ID"
        };

        // Inicializar Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const storage = firebase.storage();

        // UID del administrador (reemplaza con tu UID real)
        const ADMIN_UID = 'UID_DEL_ADMIN';

        // Mostrar login de admin
        function mostrarLoginAdmin() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('registro-section').style.display = 'none';
            document.getElementById('formulario-section').style.display = 'none';
        }

        // Mostrar registro
        function mostrarRegistro() {
            document.getElementById('registro-section').style.display = 'block';
            document.getElementById('login-section').style.display = 'none';
        }

        // Mostrar login
        function mostrarLogin() {
            document.getElementById('login-section').style.display = 'block';
            document.getElementById('registro-section').style.display = 'none';
        }

        // Registrar usuario
        function registrarUsuario() {
            const email = document.getElementById('registro-email').value;
            const password = document.getElementById('registro-password').value;
            auth.createUserWithEmailAndPassword(email, password)
                .then(userCredential => {
                    alert('Usuario registrado con 칠xito');
                    mostrarLogin();
                })
                .catch(error => {
                    alert('Error al registrar: ' + error.message);
                });
        }

        // Iniciar sesi칩n
        function iniciarSesion() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            auth.signInWithEmailAndPassword(email, password)
                .then(userCredential => {
                    mostrarFormulario();
                })
                .catch(error => {
                    alert('Error al iniciar sesi칩n: ' + error.message);
                });
        }

        // Cerrar sesi칩n
        function cerrarSesion() {
            auth.signOut().then(() => {
                document.getElementById('user-section').style.display = 'none';
                document.getElementById('formulario-section').style.display = 'none';
                document.getElementById('calculos-registrados').style.display = 'none';
                document.getElementById('admin-form').style.display = 'none';
                document.getElementById('login-section').style.display = 'block';
            });
        }

        // Mostrar formulario de calculadora
        function mostrarFormulario() {
            document.getElementById('login-section').style.display = 'none';
            document.getElementById('registro-section').style.display = 'none';
            document.getElementById('user-section').style.display = 'block';
            document.getElementById('formulario-section').style.display = 'block';
            document.getElementById('calculos-registrados').style.display = 'block';
            document.getElementById('user-email').textContent = auth.currentUser.email;
            cargarCalculosUsuario();
            mostrarAdmin();
        }

        // Mostrar formulario de admin solo si es administrador
        function mostrarAdmin() {
            if (auth.currentUser && auth.currentUser.uid === ADMIN_UID) {
                document.getElementById('admin-form').style.display = 'block';
                cargarCalculosAdmin();
            } else {
                document.getElementById('admin-form').style.display = 'none';
            }
        }

        // Calcular
        function calcular() {
            const num1 = parseFloat(document.getElementById('num1').value);
            const num2 = parseFloat(document.getElementById('num2').value);
            const operacion = document.getElementById('operacion').value;
            const guardar = document.getElementById('guardar-calculo').checked;
            let resultado;

            if (isNaN(num1) || isNaN(num2)) {
                document.getElementById('resultado').innerHTML = 'Por favor, ingresa n칰meros v치lidos.';
                return;
            }

            switch (operacion) {
                case 'suma':
                    resultado = num1 + num2;
                    break;
                case 'resta':
                    resultado = num1 - num2;
                    break;
                case 'multiplicacion':
                    resultado = num1 * num2;
                    break;
                case 'division':
                    if (num2 === 0) {
                        document.getElementById('resultado').innerHTML = 'No se puede dividir por cero.';
                        return;
                    }
                    resultado = num1 / num2;
                    break;
            }

            document.getElementById('resultado').innerHTML = `Resultado: ${resultado}`;

            if (guardar) {
                guardarCalculo(num1, num2, operacion, resultado);
            }
        }

        // Guardar c치lculo en Firestore
        function guardarCalculo(num1, num2, operacion, resultado) {
            const userId = auth.currentUser.uid;
            const calculo = {
                num1,
                num2,
                operacion,
                resultado,
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            };

            // Obtener los c치lculos actuales del usuario
            db.collection('calculos').doc(userId).collection('userCalculos').get()
                .then(snapshot => {
                    const calculos = snapshot.docs;
                    if (calculos.length >= 10) {
                        // Eliminar el c치lculo m치s antiguo
                        const oldestCalculo = calculos.sort((a, b) => {
                            const aTime = a.data().timestamp ? a.data().timestamp.toMillis() : 0;
                            const bTime = b.data().timestamp ? b.data().timestamp.toMillis() : 0;
                            return aTime - bTime;
                        })[0];
                        db.collection('calculos').doc(userId).collection('userCalculos').doc(oldestCalculo.id).delete();
                    }

                    // Agregar el nuevo c치lculo
                    db.collection('calculos').doc(userId).collection('userCalculos').add(calculo)
                        .then(() => {
                            cargarCalculosUsuario();
                        })
                        .catch(error => {
                            console.error('Error al guardar c치lculo:', error);
                            alert('Error al guardar el c치lculo');
                        });
                })
                .catch(error => {
                    console.error('Error al obtener c치lculos:', error);
                    alert('Error al obtener los c치lculos');
                });
        }

        // Cargar c치lculos del usuario
        function cargarCalculosUsuario() {
            const userId = auth.currentUser.uid;
            const lista = document.getElementById('lista-calculos');
            lista.innerHTML = '';

            db.collection('calculos').doc(userId).collection('userCalculos')
                .orderBy('timestamp', 'asc')
                .get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const calculo = doc.data();
                        const li = document.createElement('li');
                        li.textContent = `${calculo.num1} ${getOperacionSimbolo(calculo.operacion)} ${calculo.num2} = ${calculo.resultado}`;
                        lista.appendChild(li);
                    });
                })
                .catch(error => {
                    console.error('Error al cargar c치lculos:', error);
                    alert('Error al cargar los c치lculos');
                });
        }

        // Exportar c치lculos del usuario a Excel
        function exportarCalculosUsuario() {
            const userId = auth.currentUser.uid;
            const calculos = [];

            db.collection('calculos').doc(userId).collection('userCalculos')
                .orderBy('timestamp', 'asc')
                .get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const calculo = doc.data();
                        calculos.push({
                            'Primer N칰mero': calculo.num1,
                            'Operaci칩n': calculo.operacion,
                            'Segundo N칰mero': calculo.num2,
                            'Resultado': calculo.resultado,
                            'Fecha': calculo.timestamp ? calculo.timestamp.toDate().toLocaleString() : 'N/A'
                        });
                    });

                    const ws = XLSX.utils.json_to_sheet(calculos);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, 'C치lculos');
                    XLSX.writeFile(wb, 'calculos_usuario.xlsx');
                })
                .catch(error => {
                    console.error('Error al exportar c치lculos:', error);
                    alert('Error al exportar los c치lculos');
                });
        }

        // Cargar c치lculos de todos los usuarios (admin)
        function cargarCalculosAdmin() {
            const lista = document.getElementById('lista-calculos-admin');
            lista.innerHTML = '';

            db.collection('calculos').get()
                .then(snapshot => {
                    snapshot.forEach(userDoc => {
                        const userId = userDoc.id;
                        db.collection('calculos').doc(userId).collection('userCalculos')
                            .orderBy('timestamp', 'asc')
                            .get()
                            .then(userSnapshot => {
                                userSnapshot.forEach(doc => {
                                    const calculo = doc.data();
                                    const li = document.createElement('li');
                                    li.textContent = `Usuario ${userId}: ${calculo.num1} ${getOperacionSimbolo(calculo.operacion)} ${calculo.num2} = ${calculo.resultado}`;
                                    lista.appendChild(li);
                                });
                            })
                            .catch(error => {
                                console.error('Error al cargar c치lculos de usuario:', error);
                            });
                    });
                    document.getElementById('admin-calculos').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error al cargar usuarios:', error);
                    alert('Error al cargar los c치lculos de los usuarios');
                });
        }

        // Exportar todos los c치lculos a Excel (admin)
        function exportarCalculosAdmin() {
            const calculos = [];

            db.collection('calculos').get()
                .then(snapshot => {
                    const promises = [];
                    snapshot.forEach(userDoc => {
                        const userId = userDoc.id;
                        const promise = db.collection('calculos').doc(userId).collection('userCalculos')
                            .orderBy('timestamp', 'asc')
                            .get()
                            .then(userSnapshot => {
                                userSnapshot.forEach(doc => {
                                    const calculo = doc.data();
                                    calculos.push({
                                        'Usuario': userId,
                                        'Primer N칰mero': calculo.num1,
                                        'Operaci칩n': calculo.operacion,
                                        'Segundo N칰mero': calculo.num2,
                                        'Resultado': calculo.resultado,
                                        'Fecha': calculo.timestamp ? calculo.timestamp.toDate().toLocaleString() : 'N/A'
                                    });
                                });
                            })
                            .catch(error => {
                                console.error('Error al exportar c치lculos de usuario:', error);
                            });
                        promises.push(promise);
                    });

                    Promise.all(promises).then(() => {
                        const ws = XLSX.utils.json_to_sheet(calculos);
                        const wb = XLSX.utils.book_new();
                        XLSX.utils.book_append_sheet(wb, ws, 'C치lculos');
                        XLSX.writeFile(wb, 'calculos_todos.xlsx');
                    });
                })
                .catch(error => {
                    console.error('Error al exportar c치lculos:', error);
                    alert('Error al exportar los c치lculos');
                });
        }

        // Obtener s칤mbolo de la operaci칩n
        function getOperacionSimbolo(operacion) {
            switch (operacion) {
                case 'suma': return '+';
                case 'resta': return '-';
                case 'multiplicacion': return '칑';
                case 'division': return '칭';
            }
        }

        // Mostrar campos de publicidad seg칰n el tipo
        function mostrarCamposPublicidad() {
            const tipo = document.getElementById('publicidad-tipo').value;
            document.getElementById('publicidad-texto-campos').style.display = tipo === 'texto' ? 'block' : 'none';
            document.getElementById('publicidad-imagen-campos').style.display = tipo === 'imagen' ? 'block' : 'none';
        }

        // Guardar publicidad principal
        function guardarPublicidadPrincipal() {
            const tipo = document.getElementById('publicidad-tipo').value;
            const publicidadData = { tipo };

            if (tipo === 'texto') {
                publicidadData.texto = document.getElementById('publicidad-texto').value;
                publicidadData.url = document.getElementById('publicidad-url').value || '';
                guardarPublicidadEnFirestore(publicidadData);
            } else {
                const file = document.getElementById('publicidad-imagen').files[0];
                publicidadData.url = document.getElementById('publicidad-imagen-url').value || '';
                if (file) {
                    const storageRef = storage.ref(`publicidad/principal/${file.name}`);
                    storageRef.put(file).then(snapshot => {
                        snapshot.ref.getDownloadURL().then(url => {
                            publicidadData.imagenUrl = url;
                            guardarPublicidadEnFirestore(publicidadData);
                        }).catch(error => {
                            console.error('Error al obtener URL de imagen:', error);
                            alert('Error al subir la imagen');
                        });
                    }).catch(error => {
                        console.error('Error al subir imagen:', error);
                        alert('Error al subir la imagen');
                    });
                } else {
                    guardarPublicidadEnFirestore(publicidadData);
                }
            }
        }

        // Guardar publicidad en Firestore
        function guardarPublicidadEnFirestore(publicidadData) {
            db.collection('publicidad').doc('principal').set(publicidadData)
                .then(() => {
                    alert('Publicidad principal guardada con 칠xito');
                    cargarPublicidadPrincipal();
                })
                .catch(error => {
                    console.error('Error al guardar publicidad:', error);
                    alert('Error al guardar publicidad');
                });
        }

        // Cargar publicidad principal
        function cargarPublicidadPrincipal() {
            db.collection('publicidad').doc('principal').get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const section = document.getElementById('publicidad-section');
                        section.innerHTML = '';

                        if (data.tipo === 'texto') {
                            const p = document.createElement('p');
                            p.textContent = data.texto;
                            if (data.url) {
                                const a = document.createElement('a');
                                a.href = data.url;
                                a.target = '_blank';
                                a.appendChild(p);
                                section.appendChild(a);
                            } else {
                                section.appendChild(p);
                            }
                        } else if (data.imagenUrl) {
                            const img = document.createElement('img');
                            img.src = data.imagenUrl;
                            if (data.url) {
                                const a = document.createElement('a');
                                a.href = data.url;
                                a.target = '_blank';
                                a.appendChild(img);
                                section.appendChild(a);
                            } else {
                                section.appendChild(img);
                            }
                        }
                    }
                })
                .catch(error => {
                    console.error('Error al cargar publicidad principal:', error);
                });
        }

        // Guardar publicidad secundaria
        function guardarPublicidadSecundaria() {
            const file = document.getElementById('donaciones-imagen').files[0];
            const url = document.getElementById('donaciones-url').value || '';

            if (file) {
                const storageRef = storage.ref(`publicidad/secundaria/${file.name}`);
                storageRef.put(file).then(snapshot => {
                    snapshot.ref.getDownloadURL().then(imagenUrl => {
                        db.collection('publicidad').doc('secundaria').set({ imagenUrl, url })
                            .then(() => {
                                alert('Publicidad secundaria guardada con 칠xito');
                                cargarPublicidadSecundaria();
                            })
                            .catch(error => {
                                console.error('Error al guardar publicidad secundaria:', error);
                                alert('Error al guardar publicidad secundaria');
                            });
                    }).catch(error => {
                        console.error('Error al obtener URL de imagen:', error);
                        alert('Error al subir la imagen');
                    });
                }).catch(error => {
                    console.error('Error al subir imagen:', error);
                    alert('Error al subir la imagen');
                });
            } else {
                db.collection('publicidad').doc('secundaria').set({ url })
                    .then(() => {
                        alert('Publicidad secundaria guardada con 칠xito');
                        cargarPublicidadSecundaria();
                    })
                    .catch(error => {
                        console.error('Error al guardar publicidad secundaria:', error);
                        alert('Error al guardar publicidad secundaria');
                    });
            }
        }

        // Cargar publicidad secundaria
        function cargarPublicidadSecundaria() {
            db.collection('publicidad').doc('secundaria').get()
                .then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        const section = document.getElementById('donaciones-section');
                        let img = section.querySelector('img');
                        const a = section.querySelector('a');

                        if (data.imagenUrl) {
                            if (!img) {
                                img = document.createElement('img');
                                section.insertBefore(img, a);
                            }
                            img.src = data.imagenUrl;
                        } else if (img) {
                            img.remove();
                        }

                        if (data.url) {
                            a.href = data.url;
                        } else {
                            a.href = 'https://www.paypal.com/donate?hosted_button_id=TU_CODIGO';
                        }
                    }
                })
                .catch(error => {
                    console.error('Error al cargar publicidad secundaria:', error);
                });
        }

        // Cerrar pop-up
        function cerrarPopup() {
            document.getElementById('popup').style.display = 'none';
        }

        // Listener de autenticaci칩n
        auth.onAuthStateChanged(user => {
            if (user) {
                mostrarFormulario();
            } else {
                document.getElementById('login-section').style.display = 'block';
                document.getElementById('user-section').style.display = 'none';
                document.getElementById('formulario-section').style.display = 'none';
                document.getElementById('calculos-registrados').style.display = 'none';
                document.getElementById('admin-form').style.display = 'none';
            }
        });

        // Cargar publicidad al iniciar
        cargarPublicidadPrincipal();
        cargarPublicidadSecundaria();
    </script>
</body>
</html>
